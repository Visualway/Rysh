{% extends 'core/base.html' %}
{% load humanize %}
{% load mention %}
{% load convert_markdown %}

{% load static %}
{% block title %}
{{ usr.username | title }}
{% endblock title %}
{% block content %}
<div class="columns">
    <div class="column is-8">
        <div class="box">
            <figure class="image is-64x64">
                <img class="is-rounded" src="{{ usr.profile.image.url }}">
            </figure>
            {% if usr.get_full_name %}
            <p class="title is-4">{{ usr.get_full_name | title }}{% if usr.profile.verified %}
                <i class="fas fa-check-circle"></i>
                {% endif %}
                <br>
                <small class="small"><a>@{{usr.username}}</a></small>
            </p>
            {% else %}
            <p class="title is-4">{{ usr.username | title }}{% if usr.profile.verified %}
                <i class="fas fa-check-circle"></i>
                <br>
                {% endif %}
                <small><a>@{{usr.username}}</a></small>

            </p>
            {% endif %}
            <p>
                Followers: <a href="{% url 'followers' usr.username %}">{{ usr.profile.followed_by.count }}</a>
                <br>
                Following: <a href="{% url 'following' usr.username %}">{{ usr.profile.follows.count }}</a>
            </p>
            <br>
            <p>
                {{ usr.profile.bio | mention | safe | convert_markdown}}
            </p>
            <br>
            <div class="buttons">


                {% if user == usr %}

                <a href="{% url 'profile' %}" class="button is-success">Edit Profile¬†¬†üìù</a>
                {% else %}

                {% if not usr.profile in user.profile.follows.all %}
                <form action="{% url 'follow' %}" method="POST">
                    {% csrf_token %}
                    <input type="hidden" name="username" value="{{ usr.username }}">
                    <button class="button is-success" type="submit">Follow¬†¬†‚ûï</button>
                </form>
                {% else %}
                <form action="{% url 'unfollow' %}" method="POST">
                    {% csrf_token %}
                    <input type="hidden" name="username" value="{{ usr.username }}">
                    <button class="button is-success" type="submit">Unfollow¬†¬†‚ûñ</button>
                </form>
                {% endif %}
                {% endif %}
                
                {% if not usr == user %}
                ¬†¬†<a href="{% url 'message_user' usr.username %}" class="button is-success">Message¬†¬†üì®</a>
                    
                {% endif %}
                    
            </div>
        </div>
        {% for vit in vits %}
        {% include 'vit/extends/vit_block.html' %}
        {% endfor %}
        <div class="pagination">
            <span class="step-links">
                {% if vits.has_previous %}
                <a href="?page=1">&laquo; first</a>
                <a href="?page={{ vits.previous_page_number }}">previous</a>
                {% endif %}
                <span class="current">
                    Page {{ vits.number }} of {{ vits.paginator.num_pages }}.
                </span>
                {% if vits.has_next %}
                <a href="?page={{ vits.next_page_number }}">next</a>
                <a href="?page={{ vits.paginator.num_pages }}">last &raquo;</a>
                {% endif %}
            </span>
        </div>
    </div>
    <div class="column is-4">
        {% include 'accounts/extends/side_block.html' %}
    </div>
    {% endblock content %}


    {% block script %}
    <script>
         // Just a simple script which sends the server to like a post
    // for more info please see apps/vit/api.py
    function like_vit(vit_id) {
        fetch(`/api/v1/vit/add_like/?vit_pk=${vit_id}`, {
            method: 'GET',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'type': 'application/json'
            }
        }).then(function (response) {
            return response.json();
        }).then(function (data) {
            if (data.status == 'success') {
                var like_count = document.getElementById('like_count_' + vit_id);
                like_count.innerHTML = data.like_count;
                var like_count = document.getElementById('like_count_' + vit_id);
                like_count.innerHTML = data.likes;
            }
        });
    }
    </script>
    {% endblock script %}